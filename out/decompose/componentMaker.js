import{APPLY_PROPS,RAWC,RAWO}from"./consts/symbols.js";import{PROXY}from"./consts/proxy.js";import{Template}from"./classes/Template.js";export function componentMaker(e){let t=new Template(e.lines,e.keys).setName(e.name);e.onLoad&&t.setOnLoad(e.onLoad),e.style&&t.setStyle(e.style),e.callbacks&&Object.entries(e.callbacks).forEach((([e,s])=>{t.callbacks[e]=s})),e.observables&&Object.entries(e.observables).forEach((([e,s])=>{t.observables[e]=s}));return class{constructor(e){this.properties={};let s={};Object.assign(this.properties,t.properties),e&&e.components?(Object.assign(s,e.components),delete e.components):Object.assign(s,t.properties.components),e&&Object.entries(e).forEach((([e,t])=>{t&&(this.properties[e]=t)})),this.element=document.createElement(`de-${t.name}`),this.element.appendChild(t[APPLY_PROPS](this.properties)),this.elements={components:{}},Object.entries(s).forEach((([e,t])=>{let s=this.element.querySelector(this.properties.components[e]);s&&(t&&"object"==typeof t&&(s.insertAdjacentElement("afterend",t.element),this.elements.components[e]=t,t.onLoad&&t.onLoad()),s.remove())})),t.elements.forEach((e=>{console.log(`[de-name="${e}"]`),this.elements[e]=this.element.querySelector(`[de-name="${e}"]`)})),this.callbacks=new Proxy(Object.create(null),PROXY.callbacks),Object.entries(t[RAWC]).forEach((([e,t])=>{let s=t.bind(this);this.callbacks[e]=s})),this.observables=new Proxy(Object.create(null),PROXY.observables),Object.entries(t[RAWO]).forEach((([e,t])=>{this.observables[e]=t}));let n=t.onLoad;n&&(this.onLoad=n.bind(this));let o=()=>{this.element.isConnected&&this.onLoad&&(document.body.removeEventListener("attached",o),this.onLoad())};return document.body.addEventListener("attached",o),this}get name(){return t.name}toString(){return this.element.outerHTML}toLocaleString(){return this.element.outerHTML}valueOf(){return this.element}}}