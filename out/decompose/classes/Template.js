import{VALUE,ANNOUNCE,HTML,APPLY_PROPS}from"../consts.js";import{tError}from"../tError.js";import{withValue,findJsVars,templateToFunc}from"../funcs.js";import{Observable}from"./Observable.js";import{ObservableValue}from"./ObservableValue.js";export class Template{static create(e,...t){return new Template(e,t)}constructor(e,t){this.callbacks=new Proxy(Object.create(null),{defineProperty:(e,t)=>(tError.e801("this.callbacks",t),!0),get:(e,t)=>e[t],set:(e,t,r)=>(r.id=Symbol(),Object.defineProperty(e,t,withValue(r,!0)),!0)}),this.observables=new Proxy(Object.create(null),{defineProperty:(e,t)=>(tError.e801("this.observables",t),!0),get:(e,t)=>new ObservableValue(e[t]),set:(e,t,r)=>(e[t]?e[t][VALUE]=r:e[t]=new Observable(r),e[t][ANNOUNCE](),!0)});let r=0;return this.properties={},console.log(t),t[0].forEach(((e,s)=>{"string"==typeof e?this.properties[e]="":(this.properties[`cProp${r}`]="function"==typeof e?e():"object"==typeof e?e.$:e,t[0][s]=`cProp${r}`,r+=1)})),console.log(this.properties),this[APPLY_PROPS]=()=>templateToFunc(e,t)(this.properties),this[HTML]=e,this}get name(){return this.Name}setName(e){return this.Name=e,customElements.define(`d-${this.Name}`,class extends HTMLElement{}),this.element=document.createElement(`d-${this.Name}`),this.elements={},findJsVars(this[HTML].join(".")).forEach((e=>{Object.defineProperty(this.elements,e,{get:()=>this.element.querySelector(`[jayes-name="${e}"]`),set:()=>{},enumerable:!0,configurable:!1})})),this}setOnLoad(e){return this.onLoad=e,this}setCallbacks(e){return Object.entries(e).forEach((([e,t])=>{this.callbacks[e]=t})),this}setObservables(e){return Object.entries(e).forEach((([e,t])=>{this.observables[e]=t()})),this}}