function e(e){this.wrapped=e}function t(t){var s,r;function n(s,r){try{var l=t[s](r),i=l.value,a=i instanceof e;Promise.resolve(a?i.wrapped:i).then(function(e){a?n("return"===s?"return":"next",e):o(l.done?"return":"normal",e)},function(e){n("throw",e)})}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":s.resolve({value:t,done:!0});break;case"throw":s.reject(t);break;default:s.resolve({value:t,done:!1})}(s=s.next)?n(s.key,s.arg):r=null}this._invoke=function(e,t){return new Promise(function(o,l){var i={key:e,arg:t,resolve:o,reject:l,next:null};r?r=r.next=i:(s=r=i,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}t.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)};const s=Symbol(),r=Symbol(),n=Symbol(),o=Symbol(),l=Symbol(),i=Symbol(),a=Symbol(),c=Symbol(),u=Symbol(),h=Symbol(),p=Symbol(),d=Symbol(),b={e703(){console.log("TERROR-903::invalid value, can't store functions and symbols in state!")},e801(e,t){console.log(`TERROR-801::Attempted to use Object.defineProperty on ${e}, please use the default setter ('${e}.${t} = ') instead`)},e821(e){console.log(`TERROR-821::${e} is not a valid callback!`)},e903(e){console.log(`TERROR-903::invalid style, ${e} is not a string value!`)}};function y(e,t=!1){var s=y.$||(y.$={enumerable:t,writable:!1,configurable:!1,value:e});return s.value!==e&&(s.value=e),s}function m(e,t){if(!e[t])if(7===e[u].type){let s=e[u].cssRules.length;e[u].appendRule(t+" {}"),e[t]=e[u].cssRules[s]}else{let s=e[u].cssRules.length;e[u].insertRule(t+" {}",s),e[t]=e[u].cssRules[s]}}function f(e,t){let s=e.replaceAll(/^[ ]*([@].*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([&].*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([^&}@]?.*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([-=a-zA-Z ]+):[ ]*(.+)[ ]*$/gm,'"$1": "$2",').replaceAll(/^[ ]*(})[ ]*$/gm,"$1,").replaceAll(/,[ ]*\n[ ]*\}/g,"\n}").replaceAll(/,[ ]*$/g,"");console.log(s);let r=JSON.parse(`{${s}}`);function n(e,t,s){Object.entries(e).forEach(([r,o])=>{if("object"==typeof o&&r.startsWith("&")){let l=r.replace(/^&/,"");t[s+l]=o,Object.entries(o).forEach(([e,r])=>{"object"==typeof r&&e.startsWith("&")&&n(t[s+l],t,s+l)}),delete e[r]}})}return Object.entries(r).forEach(([e,s])=>{if("object"==typeof s){let o=`${t} > ${e}`;r[o]=s,delete r[e],n(r[o],r,o)}}),r}class v{constructor(e){return this[r]={},this[s]=e,Object.seal(this),this}[n](){Object.getOwnPropertySymbols(this[r]).forEach(e=>this[r][e](this[s]))}[o](e){this[r][e.id]=e}[l](e){delete this[r][e.id]}valueOf(){return this[s]}toString(){return this[s]}toLocaleString(){return this[s]}}class g{constructor(e){this.value=e[s];let t=e=>!!e.id||(b.e821(e),!1);return Object.defineProperty(this,"addObserver",y(s=>(t(s)&&e[o](s),this),!0)),Object.defineProperty(this,"deleteObserver",y(s=>(t(s)&&e[l](s),this),!0)),this}valueOf(){return this.value}toLocaleString(){return this.value}toString(){return this.value}}const w={callbacks:{defineProperty:(e,t)=>(b.e801("this.callbacks",t),!0),get:(e,t)=>e[t],set:(e,t,s)=>(s.id=Symbol(),Object.defineProperty(e,t,y(s,!0)),!0)},observables:{defineProperty:(e,t)=>(b.e801("this.observables",t),!0),get:(e,t)=>new g(e[t]),set:(e,t,r)=>(e[t]?e[t][s]=r:e[t]=new v(r),e[t][n](),!0)},components:{defineProperty(){b.e821("componentsRegistry")},get:(e,t)=>e[t],set:()=>!0},style:{get:(e,t)=>(m(e,t),(s,r)=>{e[t].style.setProperty(s,r)}),set:(e,t,[s,r])=>(m(e,t),e[t].style.setProperty(s,r),!0)}},$=function*(){let e=0;for(;;)yield`GID${e}${Date.now()}${e}`,e+=1}();var O={val:"",get(){return this.val=$.next().value,this.val}},j=new class{constructor(){this[c]=document.createElement("style"),this[c].id="destyle",document.head.appendChild(this[c]);let e=Object.create(null);e[u]=this[c].sheet,console.log(e),this[h]=new Proxy(e,w.style),this[p]={rules:Object.create(null),new(t){let s=e[u].cssRules.length;e[u].insertRule(t+" {}",s);let r=Object.create(null);return r[u]=e[u].cssRules[s],this.rules[t]=new Proxy(r,w.style),this.rules[t]}}}setStyle(e){let t=(e,t)=>{Object.entries(t).forEach(([t,s])=>{"object"!=typeof s?this[h][e](t,s):b.e903(s)})},s=(e,t)=>{this[p].new(e),Object.entries(t).forEach(([t,s])=>{Object.entries(s).forEach(([s,r])=>{"object"!=typeof r?this[p].rules[e][t](s,r):b.e903(r)})})};Object.entries(e).forEach(([e,r])=>{e.startsWith("@")?s(e,r):t(e,r)})}};class S{constructor(e,t){this[i]=Object.create(null),this[a]=Object.create(null),this.callbacks=new Proxy(this[i],w.callbacks),this.observables=new Proxy(this[a],w.observables),this.properties={components:{}};let s=0;t.forEach((r,n)=>{let o,l;switch(typeof r){case"string":o=[...e[n].matchAll(/<$/g)],l=[...e[n+1].matchAll(/^>/g)],o[0]&&l[0]?(O.get(),this.properties[r]=`gid value="${O.val}"></gid`,this.properties.components[r]=`gid[value="${O.val}"]`):this.properties[r]="";break;case"function":this.properties[`cProp${s}`]=r();break;case"object":this.properties[`cProp${s}`]=r.$;break;default:this.properties[`cProp${s}`]=r,t[n]=`cProp${s}`,s+=1}}),console.log(this.properties),this.elements=[];let r=function(e){let t=e.join(""),s=[],r=[...t.matchAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*>)/g)],n=[];return console.log(r),r.forEach(e=>{n.push(e[2])}),e.forEach(e=>s.push(e.replaceAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*>)/g,'$1de-name="$2" '))),{names:n,lines:s}}(e);return r.names.forEach(e=>this.elements.push(e)),this[d]=function(e,t){return s=>{let r=e[0];return console.log(t),t.forEach((t,n)=>{r+=s[t]?s[t]:"",r+=e[n+1]}),(new DOMParser).parseFromString(r,"text/html").body.firstChild}}(r.lines,t),console.log(r),this}get name(){return this.Name}setStyle(e){this.style=f(e,`de-${this.Name}`),j.setStyle(this.style)}setName(e){return this.Name=e,customElements.define(`de-${this.Name}`,class extends HTMLElement{}),this.element=document.createElement(`de-${this.Name}`),this}setOnLoad(e){return this.onLoad=e,this}}let E=Object.create(null);var k=new Proxy(E,w.components);window.history.pushState('{ "de$": [ "file:///Users/alexgavrikov/Developer/lampasch/ledit/ledit/test.html" ] }',"");let P={get(e,t){let s=JSON.parse(window.history.state);return console.log(s),console.log(e[t]),s.de$[e[t]]},set(e,t,s){if("function"==typeof s||"symbol"==typeof s)return b.e703(),!1;let r=JSON.parse(window.history.state);return"url"===t?r.de$[0]=s:e[t]?r.de$[e[t]]=s:(e[t]=r.de$.length,r.de$.push(s)),window.history.pushState(JSON.stringify(r),"",r.de$[0]),!0}},R=Object.create(null);R.url=0;var x=new Proxy(R,P);let L={components:k,compose:function(e,...t){return s=>(s.lines=e,s.keys=t,E[s.name]=function(e){let t=new S(e.lines,e.keys).setName(e.name);return e.onLoad&&t.setOnLoad(e.onLoad),e.style&&t.setStyle(e.style),e.callbacks&&Object.entries(e.callbacks).forEach(([e,s])=>{t.callbacks[e]=s}),e.observables&&Object.entries(e.observables).forEach(([e,s])=>{t.observables[e]=s}),class{constructor(e){this.properties={};let s={};Object.assign(this.properties,t.properties),e&&e.components?(Object.assign(s,e.components),delete e.components):Object.assign(s,t.properties.components),e&&Object.entries(e).forEach(([e,t])=>{t&&(this.properties[e]=t)}),this.element=document.createElement(`de-${t.name}`),this.element.appendChild(t[d](this.properties)),Object.entries(s).forEach(([e,t])=>{let s=this.element.querySelector(this.properties.components[e]);s&&(t&&"object"==typeof t&&(s.insertAdjacentElement("afterend",t.element),t.onLoad&&t.onLoad()),s.remove())}),this.elements={},t.elements.forEach(e=>{console.log(`[de-name="${e}"]`),this.elements[e]=this.element.querySelector(`[de-name="${e}"]`)}),this.callbacks=new Proxy(Object.create(null),w.callbacks),Object.entries(t[i]).forEach(([e,t])=>{let s=t.bind(this);this.callbacks[e]=s}),this.observables=new Proxy(Object.create(null),w.observables),Object.entries(t[a]).forEach(([e,t])=>{this.observables[e]=t});let r=t.onLoad;return r&&(this.onLoad=r.bind(this)),this}get name(){return t.name}toString(){return this.element.outerHTML}toLocaleString(){return this.element.outerHTML}valueOf(){return this.element}}}(s),k)},globs:{},deps:[],load:async e=>(await import(e)).default.bind(L),async loader(e){let s=(r=function*(e){for(let t of e)yield L.load(t)},n=function(){return new t(r.apply(this,arguments))},function(e){return n.apply(this,arguments)})(e);var r,n,o,l=!0,i=!1;try{for(var a,c,u=function(e){var t;if("undefined"!=typeof Symbol&&(Symbol.asyncIterator&&(t=e[Symbol.asyncIterator]),null==t&&Symbol.iterator&&(t=e[Symbol.iterator])),null==t&&(t=e["@@asyncIterator"]),null==t&&(t=e["@@iterator"]),null==t)throw new TypeError("Object is not async iterable");return t.call(e)}(s);l=(a=await u.next()).done,c=await a.value,!l;l=!0)c()}catch(e){i=!0,o=e}finally{try{l||null==u.return||await u.return()}finally{if(i)throw o}}},async loaded(){await L.loader(L.deps),customElements.define("de-compose",class extends HTMLElement{}),L.main(L),console.log(x),L.loaded=!0},detachedCallback:function(e){let t=t=>e(t);return t.id=Symbol(),t},state:x,main:void 0};Object.seal(L),window.addEventListener("DOMContentLoaded",L.loaded);export{L as de};
