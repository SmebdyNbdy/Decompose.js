function e(e){this.wrapped=e}function t(t){var n,s;function r(n,s){try{var l=t[n](s),i=l.value,a=i instanceof e;Promise.resolve(a?i.wrapped:i).then(function(e){a?r("return"===n?"return":"next",e):o(l.done?"return":"normal",e)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?r(n.key,n.arg):s=null}this._invoke=function(e,t){return new Promise(function(o,l){var i={key:e,arg:t,resolve:o,reject:l,next:null};s?s=s.next=i:(n=s=i,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}t.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)};const n=Symbol(),s=Symbol(),r=Symbol(),o=Symbol(),l=Symbol(),i=Symbol(),a=Symbol(),c=Symbol(),u=Symbol(),h=Symbol(),d={e703(){console.log("TERROR-903::invalid value, can't store functions and symbols in state!")},e801(e,t){console.log(`TERROR-801::Attempted to use Object.defineProperty on ${e}, please use the default setter ('${e}.${t} = ') instead`)},e821(e){console.log(`TERROR-821::${e} is not a valid callback!`)},e903(e){console.log(`TERROR-903::invalid style, ${e} is not a string value!`)}};let p=()=>{let e=.01*window.innerHeight,t=.01*window.innerWidth;document.body.style.setProperty("--mh",e+"px"),document.body.style.setProperty("--mw",t+"px")};function m(e,t=!1){var n=m.$||(m.$={enumerable:t,writable:!1,configurable:!1,value:e});return n.value!==e&&(n.value=e),n}p(),window.onresize=p;class b{constructor(e){return this[s]={},this[n]=e,Object.seal(this),this}[r](){Object.getOwnPropertySymbols(this[s]).forEach(e=>this[s][e](this[n]))}[o](e){this[s][e.id]=e}[l](e){delete this[s][e.id]}valueOf(){return this[n]}toString(){return this[n]}toLocaleString(){return this[n]}}class f{constructor(e){this.value=e[n];let t=e=>!!e.id||(d.e821(e),!1);return Object.defineProperty(this,"addObserver",m(n=>(t(n)&&e[o](n),this),!0)),Object.defineProperty(this,"deleteObserver",m(n=>(t(n)&&e[l](n),this),!0)),this}valueOf(){return this.value}toLocaleString(){return this.value}toString(){return this.value}}const y={callbacks:{defineProperty:(e,t)=>(d.e801("this.callbacks",t),!0),get:(e,t)=>e[t],set:(e,t,n)=>(n.id=Symbol(),Object.defineProperty(e,t,m(n,!0)),!0)},observables:{defineProperty:(e,t)=>(d.e801("this.observables",t),!0),get:(e,t)=>new f(e[t]),set:(e,t,s)=>(e[t]?e[t][n]=s:e[t]=new b(s),e[t][r](),!0)},components:{defineProperty(){d.e821("componentsRegistry")},get:(e,t)=>e[t],set:()=>!0}},g=function*(){let e=0;for(;;)yield`GID${e}${Date.now()}${e}`,e+=1}();var w={val:"",get(){return this.val=g.next().value,this.val}};class v{static get regex(){return{nestRegularize:/(@nest)([^{\n]+{[^}]+})/g,nesting:/(^|;|})\s*([\w\-.#:[="\]~>+ ,*]*[\w\-\]*])(?:\s*{)((?:\s*(?:[\w-]+):[^;]+;)*)(?:\s*)(\s*[&\w\-.#:[="\]~>+ ,*]*[\w\-\]*])(?:\s*{)((?:(?:\s*(?:[\w-]+):[^;]+;)|(?:\s*&[^{}]+{[\s\S]*?}))*\s*})/,cleanup:/@[\w\-:( )%&]+\s*{\s*\s*}/g,nestCleanup:/(@nest\s?{\s?)(?:(?:|[^{}]|{[^{}]*})+)(\s})/g,queries:/([\w\-.#:[="\]~>+ ,*]*[\w\-\]*])(?:\s*{)((?:(?:[^{@}]*)|(?:[^{@}]*{[\s\S]*?}[^{@}]*))*)(\s*@[\w\-:( )%&]+\s*{\s*)(?:\s*)(\s*[&\w\-.#:[="\]~>+ ,*]*[\w\-\]*])(?:\s*{)((?:(?:\s*(?:[\w-]+):[^;]+;)|(?:\s*&[^&{}]+{[\s\S]*?}))*\s*})\s*}/,scope:/((?:^|})\s*)([^&{,}]*(?:{|,))/,separate:/(^)(\s*[^{}]*{)((?:[^{}]*)|(?:[^{}]*{[^{}]*})*)(\s*})/}}static get normalize(){return e=>e.replaceAll(/\s+/g," ").replaceAll(/(\s*)(\{|\}|;)(\s*)/g,"$2 ").replaceAll(v.regex.nestRegularize,"$1 {$2}")}static get replaceNesting(){return(e,t,n,s,r,o)=>{let l=n.split(","),i=r.split(","),a=[];for(let e in l){let t=l[e];for(let e in i)a.push(i[e].replace("&",t))}return`${t}${a.join(",")} {${o}${n} {${s}`}}static get replaceQueries(){return(e,t,n,s,r,o)=>{let l=t.split(","),i=r.split(","),a=[];for(let e in l){let t=l[e];for(let e in i)i[e].replace("&",t)!==a[a.length-1]&&a.push(i[e].replace("&",t))}return`${s}${a.join(",")} {${o}} ${t} {${n}`}}constructor(){this.timeElapsed={t0:Date.now(),t1:void 0},this[c]=document.createElement("style"),this[c].id="de-style",document.head.appendChild(this[c]),this[u]=this[c].sheet}get insertRule(){return e=>(this[u].insertRule(e),"")}insert(e){let t=v.normalize(e);this.timeElapsed.t0=Date.now();let n=(e,n)=>{for(;t.match(e);)t=t.replace(e,n);return t};return n(v.regex.queries,v.replaceQueries),n(v.regex.cleanup,()=>""),n(v.regex.nestCleanup,()=>""),n(v.regex.nesting,v.replaceNesting),n(v.regex.separate,this.insertRule),this.timeElapsed.t1=Date.now(),console.log(`stylesheet build time is ${(this.timeElapsed.t1-this.timeElapsed.t0)/100} s`),this}insertScoped(e,t){let n=v.normalize(t);for(;n.match(v.regex.scope);)n=n.replace(v.regex.scope,"$1& $2");return n=`${e} { ${n} }`,this.insert(n)}}var $=new v;$.insert("de-group {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-evenly;\n    align-content: space-evenly;\n    &[col] {\n        flex-direction: column;\n        justify-content: stretch;\n    }\n    &[stretch] {\n        align-items: stretch;\n    }\n    &[wrap] {\n        flex-wrap: wrap;\n        justify-content: space-evenly;\n    }\n}");class E{constructor(e,t){this[i]=Object.create(null),this[a]=Object.create(null),this.callbacks=new Proxy(this[i],y.callbacks),this.observables=new Proxy(this[a],y.observables),this.properties={components:{}};let n=0;t.forEach((s,r)=>{let o,l;switch(typeof s){case"string":o=[...e[r].matchAll(/<$/g)],l=[...e[r+1].matchAll(/^>/g)],o[0]&&l[0]?(w.get(),this.properties[s]=`gid value="${w.val}"></gid`,this.properties.components[s]=`gid[value="${w.val}"]`):this.properties[s]="";break;case"function":this.properties[`cProp${n}`]=s();break;case"object":this.properties[`cProp${n}`]=s.$;break;default:this.properties[`cProp${n}`]=s,t[r]=`cProp${n}`,n+=1}}),console.log(this.properties),this.elements=[];let s=function(e){let t=e.join(""),n=[],s=[...t.matchAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*>)/g)],r=[];return console.log(s),s.forEach(e=>{r.push(e[2])}),e.forEach(e=>n.push(e.replaceAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*(?:>|$))/g,'$1de-name="$2" '))),{names:r,lines:n}}(e);return s.names.forEach(e=>this.elements.push(e)),this[h]=function(e,t){return n=>{let s=e[0];return console.log(t),t.forEach((t,r)=>{s+=n[t]?n[t]:"",s+=e[r+1]}),(new DOMParser).parseFromString(s,"text/html").body.firstChild}}(s.lines,t),console.log(s),this}get name(){return this.Name}setStyle(e){$.insertScoped(`de-${this.Name}`,e)}setName(e){return this.Name=e,customElements.define(`de-${this.Name}`,class extends HTMLElement{constructor(){super(),$.insert(`${this.tagName} {\n                        display: contents;\n                    }`)}}),this.element=document.createElement(`de-${this.Name}`),this}setOnLoad(e){return this.onLoad=e,this}}function S(e){let t=new E(e.lines,e.keys).setName(e.name);return e.onLoad&&t.setOnLoad(e.onLoad),e.style&&t.setStyle(e.style),e.callbacks&&Object.entries(e.callbacks).forEach(([e,n])=>{t.callbacks[e]=n}),e.observables&&Object.entries(e.observables).forEach(([e,n])=>{t.observables[e]=n}),class{constructor(e){this.properties={};let n={};Object.assign(this.properties,t.properties),e&&e.components?(Object.assign(n,e.components),delete e.components):Object.assign(n,t.properties.components),e&&Object.entries(e).forEach(([e,t])=>{t&&(this.properties[e]=t)}),this.element=document.createElement(`de-${t.name}`),this.element.appendChild(t[h](this.properties)),this.elements={components:{}},Object.entries(n).forEach(([e,t])=>{let n=this.element.querySelector(this.properties.components[e]);n&&(t&&"object"==typeof t&&(n.insertAdjacentElement("afterend",t.element),this.elements.components[e]=t,t.onLoad&&t.onLoad()),n.remove())}),t.elements.forEach(e=>{console.log(`[de-name="${e}"]`),this.elements[e]=this.element.querySelector(`[de-name="${e}"]`)}),this.callbacks=new Proxy(Object.create(null),y.callbacks),Object.entries(t[i]).forEach(([e,t])=>{let n=t.bind(this);this.callbacks[e]=n}),this.observables=new Proxy(Object.create(null),y.observables),Object.entries(t[a]).forEach(([e,t])=>{this.observables[e]=t});let s=t.onLoad;s&&(this.onLoad=s.bind(this));let r=()=>{this.element.isConnected&&this.onLoad&&(document.body.removeEventListener("attached",r),this.onLoad())};return document.body.addEventListener("attached",r),this}get name(){return t.name}toString(){return this.element.outerHTML}toLocaleString(){return this.element.outerHTML}valueOf(){return this.element}}}let O=Object.create(null);var j=new Proxy(O,y.components);window.history.replaceState(`{ "de$": [ "${location.href}" ] }`,"");let x={get(e,t){let n=JSON.parse(window.history.state);return console.log(n),console.log(e[t]),n.de$[e[t]]},set(e,t,n){if("function"==typeof n||"symbol"==typeof n)return d.e703(),!1;let s=JSON.parse(window.history.state);return"url"===t?s.de$[0]=n:e[t]?s.de$[e[t]]=n:(e[t]=s.de$.length,s.de$.push(n)),window.history.pushState(JSON.stringify(s),"",s.de$[0]),!0}},L=Object.create(null);L.url=0;var k=new Proxy(L,x);let P=Object.create(null);var R,A,N=new Proxy(P,y.components),T={elements:{page:document.querySelector("de-compose")}},C={set head(e){T.element.insertAdjacentElement("beforebegin",(R=e).element),A=R.callbacks.onLoad},get head(){return R},pages:N,newPage:function(e,...t){return n=>{let s=e.flat();s.unshift(`<de-compose @page@ de-page="${n.name}">${s.shift()}`),s.push(`${s.pop()}</de-compose>`),n.lines=s,n.keys=t;let r=S(n);P[n.name]={load(e){document.title=n.title;let t=new r(e);T.elements.page.insertAdjacentElement("afterend",t.elements.page),T.elements.page.remove(),T=t}}}},navigate:function e(t){N[t].load(k.props),k.url=new URL(location.protocol+location.host+location.pathname+`/#/${t}`),A&&A(),window.onpopstate=()=>{console.log(location.hash),location.hash!==`#${t}`&&e(location.hash)}}};class M extends HTMLElement{constructor(){super(),console.log(this.attributes);let e=this.querySelector("de-else");if(this.attributes.true){for(e.remove();this.childElementCount>0;){let e=this.children[0];e.remove(),this.insertAdjacentElement("beforebegin",e)}return this.remove(),this}for(;e.childElementCount>0;){let t=e.children[0];t.remove(),this.insertAdjacentElement("beforebegin",t)}return this.remove(),this}}customElements.define("de-else",class extends HTMLElement{}),customElements.define("de-group",class extends HTMLElement{}),customElements.define("de-if",M);let H={style:$.insert,components:j,compose:function(e,...t){return n=>(n.lines=e,n.keys=t,O[n.name]=S(n),j)},router:C,page:T,globs:{},deps:[],load:async e=>(await import(e)).default.bind(H),async loader(e){let n=(s=function*(e){for(let t of e)yield H.load(t)},r=function(){return new t(s.apply(this,arguments))},function(e){return r.apply(this,arguments)})(e);var s,r,o,l=!0,i=!1;try{for(var a,c,u=function(e){var t;if("undefined"!=typeof Symbol&&(Symbol.asyncIterator&&(t=e[Symbol.asyncIterator]),null==t&&Symbol.iterator&&(t=e[Symbol.iterator])),null==t&&(t=e["@@asyncIterator"]),null==t&&(t=e["@@iterator"]),null==t)throw new TypeError("Object is not async iterable");return t.call(e)}(n);l=(a=await u.next()).done,c=await a.value,!l;l=!0)c()}catch(e){i=!0,o=e}finally{try{l||null==u.return||await u.return()}finally{if(i)throw o}}},async loaded(){await H.loader(H.deps),customElements.define("de-compose",class extends HTMLElement{}),new MutationObserver(e=>{document.body.dispatchEvent(new Event("attached"))}).observe(document.body,{childList:!0,attributes:!1,subtree:!0}),H.main(H),console.log(k),H.loaded=!0},detachedCallback:function(e){let t=function(t){e(t)};return t.id=Symbol(),t},state:k,main:void 0};Object.seal(H),window.addEventListener("DOMContentLoaded",H.loaded);export{H as de};
