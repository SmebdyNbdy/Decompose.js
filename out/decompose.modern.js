function e(e){this.wrapped=e}function t(t){var n,s;function o(n,s){try{var l=t[n](s),i=l.value,a=i instanceof e;Promise.resolve(a?i.wrapped:i).then(function(e){a?o("return"===n?"return":"next",e):r(l.done?"return":"normal",e)},function(e){o("throw",e)})}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?o(n.key,n.arg):s=null}this._invoke=function(e,t){return new Promise(function(r,l){var i={key:e,arg:t,resolve:r,reject:l,next:null};s?s=s.next=i:(n=s=i,o(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}t.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)};const n=Symbol(),s=Symbol(),o=Symbol(),r=Symbol(),l=Symbol(),i=Symbol(),a=Symbol(),c=Symbol(),u=Symbol(),h=Symbol(),d=Symbol(),p=Symbol(),m={e703(){console.log("TERROR-903::invalid value, can't store functions and symbols in state!")},e801(e,t){console.log(`TERROR-801::Attempted to use Object.defineProperty on ${e}, please use the default setter ('${e}.${t} = ') instead`)},e821(e){console.log(`TERROR-821::${e} is not a valid callback!`)},e903(e){console.log(`TERROR-903::invalid style, ${e} is not a string value!`)}};function b(e,t){let n=e.replaceAll(/[\s\n]+/g," ").replaceAll(/(;|{|})(\S)/g,"$1 $2").replaceAll(/(;|{|})(\s)/g,"$1\n").replaceAll(/("([^";]*)")/g,"'$2'").replaceAll(/(")/g,"\\$1").replaceAll(/^[ ]*([@].*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([&].*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([^&}@]?.*[^ ":])[ ]*({)$/gm,'"$1": $2').replaceAll(/^[ ]*([-=a-zA-Z ]+):[ ]*([^;]+);[ ]*$/gm,'"$1": "$2",').replaceAll(/^[ ]*(})[ ]*$/gm,"$1,").replaceAll(/,[ ]*\n[ ]*\}/g,"\n}").replaceAll(/,[ ]*$/g,"");console.log(n);let s=JSON.parse(`{${n}}`);function o(e,t,n){Object.entries(e).forEach(([s,r])=>{if("object"==typeof r&&s.startsWith("&")){let l=s.replace(/^&/,"");t[n+l]=r,Object.entries(r).forEach(([e,s])=>{"object"==typeof s&&e.startsWith("&")&&o(t[n+l],t,n+l)}),delete e[s]}})}return Object.entries(s).forEach(([e,n])=>{if("object"==typeof n){let r=`${t} > ${e}`;s[r]=n,delete s[e],o(s[r],s,r)}}),s}function y(e,t){if(!e[t])if(7===e[u].type){let n=e[u].cssRules.length;e[u].appendRule(t+" {}"),e[t]=e[u].cssRules[n]}else{let n=e[u].cssRules.length;e[u].insertRule(t+" {}",n),e[t]=e[u].cssRules[n]}}function f(e,t=!1){var n=f.$||(f.$={enumerable:t,writable:!1,configurable:!1,value:e});return n.value!==e&&(n.value=e),n}class g{constructor(e){return this[s]={},this[n]=e,Object.seal(this),this}[o](){Object.getOwnPropertySymbols(this[s]).forEach(e=>this[s][e](this[n]))}[r](e){this[s][e.id]=e}[l](e){delete this[s][e.id]}valueOf(){return this[n]}toString(){return this[n]}toLocaleString(){return this[n]}}class v{constructor(e){this.value=e[n];let t=e=>!!e.id||(m.e821(e),!1);return Object.defineProperty(this,"addObserver",f(n=>(t(n)&&e[r](n),this),!0)),Object.defineProperty(this,"deleteObserver",f(n=>(t(n)&&e[l](n),this),!0)),this}valueOf(){return this.value}toLocaleString(){return this.value}toString(){return this.value}}const w={callbacks:{defineProperty:(e,t)=>(m.e801("this.callbacks",t),!0),get:(e,t)=>e[t],set:(e,t,n)=>(n.id=Symbol(),Object.defineProperty(e,t,f(n,!0)),!0)},observables:{defineProperty:(e,t)=>(m.e801("this.observables",t),!0),get:(e,t)=>new v(e[t]),set:(e,t,s)=>(e[t]?e[t][n]=s:e[t]=new g(s),e[t][o](),!0)},components:{defineProperty(){m.e821("componentsRegistry")},get:(e,t)=>e[t],set:()=>!0},style:{get:(e,t)=>(y(e,t),(n,s)=>{e[t].style.setProperty(n,s)}),set:(e,t,[n,s])=>(y(e,t),e[t].style.setProperty(n,s),!0)}},$=function*(){let e=0;for(;;)yield`GID${e}${Date.now()}${e}`,e+=1}();var O={val:"",get(){return this.val=$.next().value,this.val}},j=new class{constructor(){this[c]=document.createElement("style"),this[c].id="destyle",document.head.appendChild(this[c]);let e=Object.create(null);e[u]=this[c].sheet,console.log(e),this[h]=new Proxy(e,w.style),this[d]={rules:Object.create(null),new(t){let n=e[u].cssRules.length;e[u].insertRule(t+" {}",n);let s=Object.create(null);return s[u]=e[u].cssRules[n],this.rules[t]=new Proxy(s,w.style),this.rules[t]}}}setStyle(e){let t=(e,t)=>{Object.entries(t).forEach(([t,n])=>{"object"!=typeof n?this[h][e](t,n):m.e903(n)})},n=(e,t)=>{this[d].new(e),Object.entries(t).forEach(([t,n])=>{Object.entries(n).forEach(([n,s])=>{"object"!=typeof s?this[d].rules[e][t](n,s):m.e903(s)})})};Object.entries(e).forEach(([e,s])=>{e.startsWith("@")?n(e,s):t(e,s)})}};j.setStyle({"de-group":{display:"flex","flex-direction":"row","align-items":"center","justify-content":"space-evenly","align-content":"space-evenly"},"de-group[col]":{"flex-direction":"column","justify-content":"stretch"},"de-group[stretch]":{"align-items":"stretch"},"de-group[wrap]":{"flex-wrap":"wrap","justify-content":"space-evenly"}});class E{constructor(e,t){this[i]=Object.create(null),this[a]=Object.create(null),this.callbacks=new Proxy(this[i],w.callbacks),this.observables=new Proxy(this[a],w.observables),this.properties={components:{}};let n=0;t.forEach((s,o)=>{let r,l;switch(typeof s){case"string":r=[...e[o].matchAll(/<$/g)],l=[...e[o+1].matchAll(/^>/g)],r[0]&&l[0]?(O.get(),this.properties[s]=`gid value="${O.val}"></gid`,this.properties.components[s]=`gid[value="${O.val}"]`):this.properties[s]="";break;case"function":this.properties[`cProp${n}`]=s();break;case"object":this.properties[`cProp${n}`]=s.$;break;default:this.properties[`cProp${n}`]=s,t[o]=`cProp${n}`,n+=1}}),console.log(this.properties),this.elements=[];let s=function(e){let t=e.join(""),n=[],s=[...t.matchAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*>)/g)],o=[];return console.log(s),s.forEach(e=>{o.push(e[2])}),e.forEach(e=>n.push(e.replaceAll(/(<[\w-]+[ ]*(?:[\w-]+(?:=".+")?)*[ ]+)(?:@)([\w$][\w$]*)(?:@)(?=[^>]*(?:>|$))/g,'$1de-name="$2" '))),{names:o,lines:n}}(e);return s.names.forEach(e=>this.elements.push(e)),this[p]=function(e,t){return n=>{let s=e[0];return console.log(t),t.forEach((t,o)=>{s+=n[t]?n[t]:"",s+=e[o+1]}),(new DOMParser).parseFromString(s,"text/html").body.firstChild}}(s.lines,t),console.log(s),this}get name(){return this.Name}setStyle(e){this.style=b(e,`de-${this.Name}`),j.setStyle(this.style)}setName(e){return this.Name=e,customElements.define(`de-${this.Name}`,class extends HTMLElement{constructor(){super(),j.setStyle({[this.tagName]:{display:"contents"}})}}),this.element=document.createElement(`de-${this.Name}`),this}setOnLoad(e){return this.onLoad=e,this}}function S(e){let t=new E(e.lines,e.keys).setName(e.name);return e.onLoad&&t.setOnLoad(e.onLoad),e.style&&t.setStyle(e.style),e.callbacks&&Object.entries(e.callbacks).forEach(([e,n])=>{t.callbacks[e]=n}),e.observables&&Object.entries(e.observables).forEach(([e,n])=>{t.observables[e]=n}),class{constructor(e){this.properties={};let n={};Object.assign(this.properties,t.properties),e&&e.components?(Object.assign(n,e.components),delete e.components):Object.assign(n,t.properties.components),e&&Object.entries(e).forEach(([e,t])=>{t&&(this.properties[e]=t)}),this.element=document.createElement(`de-${t.name}`),this.element.appendChild(t[p](this.properties)),this.elements={components:{}},Object.entries(n).forEach(([e,t])=>{let n=this.element.querySelector(this.properties.components[e]);n&&(t&&"object"==typeof t&&(n.insertAdjacentElement("afterend",t.element),this.elements.components[e]=t,t.onLoad&&t.onLoad()),n.remove())}),t.elements.forEach(e=>{console.log(`[de-name="${e}"]`),this.elements[e]=this.element.querySelector(`[de-name="${e}"]`)}),this.callbacks=new Proxy(Object.create(null),w.callbacks),Object.entries(t[i]).forEach(([e,t])=>{let n=t.bind(this);this.callbacks[e]=n}),this.observables=new Proxy(Object.create(null),w.observables),Object.entries(t[a]).forEach(([e,t])=>{this.observables[e]=t});let s=t.onLoad;s&&(this.onLoad=s.bind(this));let o=()=>{this.element.isConnected&&this.onLoad&&(document.body.removeEventListener("attached",o),this.onLoad())};return document.body.addEventListener("attached",o),this}get name(){return t.name}toString(){return this.element.outerHTML}toLocaleString(){return this.element.outerHTML}valueOf(){return this.element}}}let x=Object.create(null);var L=new Proxy(x,w.components);window.history.replaceState(`{ "de$": [ "${location.href}" ] }`,"");let k={get(e,t){let n=JSON.parse(window.history.state);return console.log(n),console.log(e[t]),n.de$[e[t]]},set(e,t,n){if("function"==typeof n||"symbol"==typeof n)return m.e703(),!1;let s=JSON.parse(window.history.state);return"url"===t?s.de$[0]=n:e[t]?s.de$[e[t]]=n:(e[t]=s.de$.length,s.de$.push(n)),window.history.pushState(JSON.stringify(s),"",s.de$[0]),!0}},P=Object.create(null);P.url=0;var A=new Proxy(P,k);let R=Object.create(null);var N,T,M=new Proxy(R,w.components),C={elements:{page:document.querySelector("de-compose")}},H={set head(e){C.element.insertAdjacentElement("beforebegin",(N=e).element),T=N.callbacks.onLoad},get head(){return N},pages:M,newPage:function(e,...t){return n=>{let s=e.flat();s.unshift(`<de-compose @page@ de-page="${n.name}">${s.shift()}`),s.push(`${s.pop()}</de-compose>`),n.lines=s,n.keys=t;let o=S(n);R[n.name]={load(e){document.title=n.title;let t=new o(e);C.elements.page.insertAdjacentElement("afterend",t.elements.page),C.elements.page.remove(),C=t}}}},navigate:function e(t){M[t].load(A.props),A.url=new URL(location.protocol+location.host+location.pathname+`/#/${t}`),T&&T(),window.onpopstate=()=>{console.log(location.hash),location.hash!==`#${t}`&&e(location.hash)}}};class I extends HTMLElement{constructor(){super(),console.log(this.attributes);let e=this.querySelector("de-else");if(this.attributes.true){for(e.remove();this.childElementCount>0;){let e=this.children[0];e.remove(),this.insertAdjacentElement("beforebegin",e)}return this.remove(),this}for(;e.childElementCount>0;){let t=e.children[0];t.remove(),this.insertAdjacentElement("beforebegin",t)}return this.remove(),this}}customElements.define("de-else",class extends HTMLElement{}),customElements.define("de-group",class extends HTMLElement{}),customElements.define("de-if",I);let q={components:L,compose:function(e,...t){return n=>(n.lines=e,n.keys=t,x[n.name]=S(n),L)},router:H,page:C,globs:{},deps:[],load:async e=>(await import(e)).default.bind(q),async loader(e){let n=(s=function*(e){for(let t of e)yield q.load(t)},o=function(){return new t(s.apply(this,arguments))},function(e){return o.apply(this,arguments)})(e);var s,o,r,l=!0,i=!1;try{for(var a,c,u=function(e){var t;if("undefined"!=typeof Symbol&&(Symbol.asyncIterator&&(t=e[Symbol.asyncIterator]),null==t&&Symbol.iterator&&(t=e[Symbol.iterator])),null==t&&(t=e["@@asyncIterator"]),null==t&&(t=e["@@iterator"]),null==t)throw new TypeError("Object is not async iterable");return t.call(e)}(n);l=(a=await u.next()).done,c=await a.value,!l;l=!0)c()}catch(e){i=!0,r=e}finally{try{l||null==u.return||await u.return()}finally{if(i)throw r}}},async loaded(){await q.loader(q.deps),customElements.define("de-compose",class extends HTMLElement{}),new MutationObserver(e=>{document.body.dispatchEvent(new Event("attached"))}).observe(document.body,{childList:!0,attributes:!1,subtree:!0}),q.main(q),console.log(A),q.loaded=!0},detachedCallback:function(e){let t=function(t){e(t)};return t.id=Symbol(),t},state:A,main:void 0};Object.seal(q),window.addEventListener("DOMContentLoaded",q.loaded);export{q as de};
